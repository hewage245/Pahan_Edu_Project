<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Generate Bill - Pahana Edu</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script>
async function fetchBill() {
    const accountNumber = document.getElementById("accountNumber").value;

    if(accountNumber === "") {
        document.getElementById("billDetails").innerHTML = "<p class='text-danger'>Please enter account number.</p>";
        return;
    }

    try {
        const response = await fetch(`http://localhost:8080/api/bills/auto/${accountNumber}`);
        if(!response.ok) throw new Error("Customer not found!");

        const bill = await response.json();

        let itemsHtml = "";
        bill.items.forEach(item => {
            itemsHtml += `<tr>
                <td>${item.name}</td>
                <td>${item.quantity}</td>
                <td>${item.unitPrice}</td>
                <td>${item.quantity * item.unitPrice}</td>
            </tr>`;
        });

        document.getElementById("billDetails").innerHTML = `
            <h4>Bill Details</h4>
            <p><strong>Bill ID:</strong> ${bill.billID}</p>
            <p><strong>Account Number:</strong> ${bill.accountNumber}</p>
            <p><strong>Date:</strong> ${new Date(bill.date).toLocaleString()}</p>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Total Price</th>
                    </tr>
                </thead>
                <tbody>
                    ${itemsHtml}
                </tbody>
            </table>
            <h5>Total Amount: Rs. ${bill.totalAmount}</h5>
            <button class="btn btn-success mt-3" onclick="window.print()">Print Bill</button>
        `;
    } catch (error) {
        document.getElementById("billDetails").innerHTML = `<p class='text-danger'>${error.message}</p>`;
    }
}
</script>
</head>
<body>
<div class="container mt-5">
<h2>Auto Generate Bill (Itemized)</h2>
<div class="mb-3">
    <label>Account Number</label>
    <input type="number" class="form-control" id="accountNumber" placeholder="Enter Account Number" oninput="fetchBill()">
</div>
<div class="mt-4" id="billDetails" style="border:1px solid #ccc; padding:15px; border-radius:8px;">
<p>Bill will appear here automatically when you enter the account number.</p>
</div>
</div>
</body>
</html>
